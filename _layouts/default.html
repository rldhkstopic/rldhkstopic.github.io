<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
    
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    
    <!-- MathJax for LaTeX -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    {% comment %}{% seo %}{% endcomment %}
  </head>
  <body class="{% if page.url == '/' or page.url == '/index.html' %}home-page{% endif %}">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        <nav class="site-nav">
          <div class="trigger">
            {% for item in site.navigation %}
              <a class="page-link" href="{{ item.url | relative_url }}">{{ item.title }}</a>
            {% endfor %}
          </div>
        </nav>
      </div>
    </header>

    <main class="page-content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {% unless page.url == '/' or page.url == '/index.html' %}
    <footer class="site-footer">
      <div class="wrapper">
        <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author }}. All rights reserved.</p>
        <p>Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">GitHub Pages</a></p>
      </div>
    </footer>
    {% endunless %}
    
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
      // 메인 페이지인지 확인하여 body에 클래스 추가
      if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
        document.documentElement.classList.add('home-page');
      }

      // 카테고리 토글 함수
      function toggleCategory(link) {
        const categoryItem = link.closest('.category-item');
        const isActive = categoryItem.classList.contains('active');
        
        // 다른 카테고리 닫기 (선택사항 - 원하면 주석 처리)
        // document.querySelectorAll('.category-item').forEach(item => {
        //   if (item !== categoryItem) {
        //     item.classList.remove('active');
        //   }
        // });
        
        // 현재 카테고리 토글
        if (isActive) {
          categoryItem.classList.remove('active');
        } else {
          categoryItem.classList.add('active');
        }
      }

      // 코드 블록 확장 기능 및 줄 번호 추가
      function processCodeBlocks() {
        const codeBlocks = document.querySelectorAll('.post-content pre');
        
        codeBlocks.forEach(pre => {
          // tabindex와 outline 제거
          pre.removeAttribute('tabindex');
          pre.style.outline = 'none';
          
          const code = pre.querySelector('code');
          if (!code) return;
          
          // Prism.js가 이미 하이라이팅한 경우를 고려하여 줄 번호 추가
          const originalText = code.textContent || code.innerText;
          const lines = originalText.split('\n');
          
          if (lines.length > 1 && !code.querySelector('.line')) {
            // 줄 번호가 아직 추가되지 않은 경우
            const lineElements = lines.map((line, index) => {
              const lineSpan = document.createElement('span');
              lineSpan.className = 'line';
              lineSpan.textContent = line || ' ';
              return lineSpan;
            });
            
            code.innerHTML = '';
            lineElements.forEach(span => code.appendChild(span));
          }
          
          // 코드가 길면 확장 가능하게 만들기
          if (lines.length > 15) {
            pre.classList.add('code-expandable');
            
            if (!pre.hasAttribute('data-listener-added')) {
              pre.setAttribute('data-listener-added', 'true');
              pre.addEventListener('click', function() {
                if (pre.classList.contains('code-expanded')) {
                  pre.classList.remove('code-expanded');
                  pre.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                  pre.classList.add('code-expanded');
                  pre.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
              });
            }
          }
        });
      }
      
      // DOMContentLoaded와 Prism.js 로드 후 실행
      document.addEventListener('DOMContentLoaded', function() {
        processCodeBlocks();
        
        // Prism.js가 로드된 후에도 실행
        if (window.Prism) {
          setTimeout(processCodeBlocks, 100);
        }
      });
      
      // Prism.js autoloader가 완료된 후 실행
      if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
        window.Prism.plugins.autoloader.onload = function() {
          setTimeout(processCodeBlocks, 100);
        };
      }
    </script>
  </body>
</html>
