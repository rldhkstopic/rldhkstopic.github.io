<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
    
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-theme-light">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" id="prism-theme-dark" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    
    <!-- MathJax for LaTeX -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    {% comment %}{% seo %}{% endcomment %}
  </head>
  <body class="{% if page.url == '/' or page.url == '/index.html' %}home-page{% endif %}">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        <nav class="site-nav">
          <div class="trigger">
            {% for item in site.navigation %}
              <a class="page-link" href="{{ item.url | relative_url }}">{{ item.title }}</a>
            {% endfor %}
            <!-- ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
            <button class="theme-toggle" id="themeToggle" aria-label="í…Œë§ˆ ì „í™˜">
              <span class="theme-toggle-icon">ğŸŒ™</span>
            </button>
          </div>
        </nav>
      </div>
    </header>

    <main class="page-content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    {% unless page.url == '/' or page.url == '/index.html' %}
    <footer class="site-footer">
      <div class="wrapper">
        <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author }}. All rights reserved.</p>
        <p>Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">GitHub Pages</a></p>
      </div>
    </footer>
    {% endunless %}
    
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <script>
      // ë©”ì¸ í˜ì´ì§€ì¸ì§€ í™•ì¸í•˜ì—¬ bodyì— í´ë˜ìŠ¤ ì¶”ê°€
      if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
        document.documentElement.classList.add('home-page');
      }

      // ì¹´í…Œê³ ë¦¬ í† ê¸€ í•¨ìˆ˜
      function toggleCategory(link) {
        const categoryItem = link.closest('.category-item');
        const isActive = categoryItem.classList.contains('active');
        
        // ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ ë‹«ê¸° (ì„ íƒì‚¬í•­ - ì›í•˜ë©´ ì£¼ì„ ì²˜ë¦¬)
        // document.querySelectorAll('.category-item').forEach(item => {
        //   if (item !== categoryItem) {
        //     item.classList.remove('active');
        //   }
        // });
        
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ í† ê¸€
        if (isActive) {
          categoryItem.classList.remove('active');
        } else {
          categoryItem.classList.add('active');
        }
      }

      // ì½”ë“œ ë¸”ë¡ í™•ì¥ ê¸°ëŠ¥ ë° íŒì—… ëª¨ë‹¬
      function processCodeBlocks() {
        const codeBlocks = document.querySelectorAll('.post-content pre');
        
        codeBlocks.forEach(pre => {
          // line-numbers ì ìš©
          pre.classList.add('line-numbers');
          
          // tabindexì™€ outline ì œê±°
          pre.removeAttribute('tabindex');
          pre.style.outline = 'none';
          
          const code = pre.querySelector('code');
          if (!code) return;
          code.classList.add('line-numbers');
          
          const originalText = code.textContent || code.innerText;
          const lines = originalText.split('\n');

          // ì½”ë“œê°€ ê¸¸ë©´ í™•ì¥ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸°
          if (lines.length > 15) {
            pre.classList.add('code-expandable');
            
            if (!pre.hasAttribute('data-listener-added')) {
              pre.setAttribute('data-listener-added', 'true');
              
              // "ì „ì²´ ì½”ë“œ ë³´ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
              const afterElement = pre;
              afterElement.addEventListener('click', function(e) {
                // ::after ìš”ì†Œ í´ë¦­ í™•ì¸
                if (e.target === afterElement || e.target.closest('pre') === afterElement) {
                  const rect = afterElement.getBoundingClientRect();
                  const clickY = e.clientY - rect.top;
                  const height = rect.height;
                  
                  // í•˜ë‹¨ 60px ì˜ì—­ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
                  if (clickY > height - 60) {
                    e.preventDefault();
                    e.stopPropagation();
                    openCodeModal(pre);
                  }
                }
              });
            }
          }
        });
      }
      
      // ì½”ë“œ íŒì—… ëª¨ë‹¬ ì—´ê¸°
      function openCodeModal(preElement) {
        // ëª¨ë‹¬ì´ ì´ë¯¸ ìˆìœ¼ë©´ ì œê±°
        const existingModal = document.getElementById('code-modal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // ëª¨ë‹¬ ìƒì„±
        const modal = document.createElement('div');
        modal.id = 'code-modal';
        modal.className = 'code-modal';
        
        const code = preElement.querySelector('code');
        const codeClone = code.cloneNode(true);
        
        // ì–¸ì–´ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        const language = code.className.match(/language-(\w+)/);
        const langClass = language ? language[0] : '';
        
        modal.innerHTML = `
          <div class="code-modal-content">
            <div class="code-modal-header">
              <h3 class="code-modal-title">ì „ì²´ ì½”ë“œ${langClass ? ' (' + langClass.replace('language-', '') + ')' : ''}</h3>
              <button class="code-modal-close">ë‹«ê¸°</button>
            </div>
            <div class="code-modal-body">
              <pre class="highlight ${langClass}"><code class="${langClass}">${codeClone.innerHTML}</code></pre>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // Prism.jsë¡œ í•˜ì´ë¼ì´íŒ… (ìˆëŠ” ê²½ìš°)
        if (window.Prism && window.Prism.highlightElement) {
          const modalCode = modal.querySelector('code');
          if (modalCode) {
            window.Prism.highlightElement(modalCode);
          }
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—° í›„ active í´ë˜ìŠ¤ ì¶”ê°€
        setTimeout(() => {
          modal.classList.add('active');
        }, 10);
        
        // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        const closeBtn = modal.querySelector('.code-modal-close');
        closeBtn.addEventListener('click', () => {
          closeCodeModal(modal);
        });
        
        // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeCodeModal(modal);
          }
        });
        
        // ESC í‚¤ë¡œ ë‹«ê¸°
        const escHandler = function(e) {
          if (e.key === 'Escape') {
            closeCodeModal(modal);
            document.removeEventListener('keydown', escHandler);
          }
        };
        document.addEventListener('keydown', escHandler);
      }
      
      
      // ì½”ë“œ íŒì—… ëª¨ë‹¬ ë‹«ê¸°
      function closeCodeModal(modal) {
        modal.classList.remove('active');
        setTimeout(() => {
          modal.remove();
        }, 300);
      }
      
      // DOMContentLoadedì™€ Prism.js ë¡œë“œ í›„ ì‹¤í–‰
      document.addEventListener('DOMContentLoaded', function() {
        processCodeBlocks();
        
        // Prism.jsê°€ ë¡œë“œëœ í›„ì—ë„ ì‹¤í–‰
        if (window.Prism) {
          setTimeout(processCodeBlocks, 100);
        }
      });
      
      // Prism.js autoloaderê°€ ì™„ë£Œëœ í›„ ì‹¤í–‰
      if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
        window.Prism.plugins.autoloader.onload = function() {
          setTimeout(processCodeBlocks, 100);
        };
      }
      
      // í…Œë§ˆ ì „í™˜ ê¸°ëŠ¥
      (function() {
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const prismLight = document.getElementById('prism-theme-light');
        const prismDark = document.getElementById('prism-theme-dark');
        
        // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
        const savedTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', savedTheme);
        updatePrismTheme(savedTheme);
        
        // Prism í…Œë§ˆ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePrismTheme(theme) {
          if (prismLight && prismDark) {
            if (theme === 'dark') {
              prismLight.disabled = true;
              prismDark.disabled = false;
            } else {
              prismLight.disabled = false;
              prismDark.disabled = true;
            }
          }
        }
        
        // í…Œë§ˆ í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        if (themeToggle) {
          themeToggle.addEventListener('click', function() {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updatePrismTheme(newTheme);
            
            // Prism.js ì¬í•˜ì´ë¼ì´íŒ…
            if (window.Prism) {
              document.querySelectorAll('pre code').forEach(function(block) {
                Prism.highlightElement(block);
              });
            }
          });
        }
      })();
    </script>
  </body>
</html>
